<!DOCTYPE html>
<html lang="es" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Código de optimización ESO | Kssgarcia</title>
<meta name="keywords" content="">
<meta name="description" content="En esta publicación, presentaré un código Python para el método de optimización de ESO.
Planteamiento del problema Consideremos una viga en voladizo con una fuerza vertical de 10kN, dimensiones 20x10 metros, módulo joven de 206.8 GPa y relación de Poisson 0.28 figura 1 $RR=0.01$, $ER=0.005$.
Figura 1. Diagrama de vigas. Primero, consideremos los siguientes pasos para hacer el algoritmo:
Discretización del modelo en elementos finitos Realizar el análisis de elementos finitos de la estructura.">
<meta name="author" content="">
<link rel="canonical" href="http://kssgarcia.github.io/es/posts/how_eso/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css" integrity="sha256-v1&#43;fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://kssgarcia.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://kssgarcia.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://kssgarcia.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://kssgarcia.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="http://kssgarcia.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://kssgarcia.github.io/posts/how_eso/">
<link rel="alternate" hreflang="es" href="http://kssgarcia.github.io/es/posts/how_eso/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Código de optimización ESO" />
<meta property="og:description" content="En esta publicación, presentaré un código Python para el método de optimización de ESO.
Planteamiento del problema Consideremos una viga en voladizo con una fuerza vertical de 10kN, dimensiones 20x10 metros, módulo joven de 206.8 GPa y relación de Poisson 0.28 figura 1 $RR=0.01$, $ER=0.005$.
Figura 1. Diagrama de vigas. Primero, consideremos los siguientes pasos para hacer el algoritmo:
Discretización del modelo en elementos finitos Realizar el análisis de elementos finitos de la estructura." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://kssgarcia.github.io/es/posts/how_eso/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-23T11:48:52-05:00" />
<meta property="article:modified_time" content="2023-04-23T11:48:52-05:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Código de optimización ESO"/>
<meta name="twitter:description" content="En esta publicación, presentaré un código Python para el método de optimización de ESO.
Planteamiento del problema Consideremos una viga en voladizo con una fuerza vertical de 10kN, dimensiones 20x10 metros, módulo joven de 206.8 GPa y relación de Poisson 0.28 figura 1 $RR=0.01$, $ER=0.005$.
Figura 1. Diagrama de vigas. Primero, consideremos los siguientes pasos para hacer el algoritmo:
Discretización del modelo en elementos finitos Realizar el análisis de elementos finitos de la estructura."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://kssgarcia.github.io/es/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Código de optimización ESO",
      "item": "http://kssgarcia.github.io/es/posts/how_eso/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Código de optimización ESO",
  "name": "Código de optimización ESO",
  "description": "En esta publicación, presentaré un código Python para el método de optimización de ESO.\nPlanteamiento del problema Consideremos una viga en voladizo con una fuerza vertical de 10kN, dimensiones 20x10 metros, módulo joven de 206.8 GPa y relación de Poisson 0.28 figura 1 $RR=0.01$, $ER=0.005$.\nFigura 1. Diagrama de vigas. Primero, consideremos los siguientes pasos para hacer el algoritmo:\nDiscretización del modelo en elementos finitos Realizar el análisis de elementos finitos de la estructura.",
  "keywords": [
    
  ],
  "articleBody": "En esta publicación, presentaré un código Python para el método de optimización de ESO.\nPlanteamiento del problema Consideremos una viga en voladizo con una fuerza vertical de 10kN, dimensiones 20x10 metros, módulo joven de 206.8 GPa y relación de Poisson 0.28 figura 1 $RR=0.01$, $ER=0.005$.\nFigura 1. Diagrama de vigas. Primero, consideremos los siguientes pasos para hacer el algoritmo:\nDiscretización del modelo en elementos finitos Realizar el análisis de elementos finitos de la estructura. Eliminar elementos con menos estrés de Von Mises. Aumentar la tasa de rechazo. Repita los pasos 2-4 hasta alcanzar la fracción de volumen. Discretización La discretización se realiza con la siguiente función con la ayuda de numpy\ndef beam(L=10, H=10, F=-1000000, E=206.8e9, v=0.28, nx=20, ny=20): \"\"\" Make the mesh for a cuadrilateral model. Parameters ---------- L : float (optional) Beam's lenght H : float (optional) Beam's height F : float (optional) Vertical force. E : string (optional) Young module v : string (optional) Poisson ratio nx : int (optional) Number of element in x direction ny : int (optional) Number of element in y direction Returns ------- nodes : ndarray Nodes array mats : ndarray (1, 2) Mats array els : ndarray Elements array loads : ndarray Loads array BC : ndarray Boundary conditions nodes \"\"\" mats = np.array([[E,v]]) x, y, els = pre.rect_grid(L, H, nx, ny) nodes = np.zeros(((nx + 1)*(ny + 1), 5)) nodes[:, 0] = range((nx + 1)*(ny + 1)) nodes[:, 1] = x nodes[:, 2] = y mask = (x==L/2) nodes[mask, 3:] = -1 mask_loads = (x == -L/2) \u0026 (y \u003c H/6) \u0026 (y \u003e -H/6) loads_nodes = nodes[mask_loads, 0] loads = np.zeros((len(loads_nodes), 3)) loads[:, 0] = loads_nodes loads[:, 2] = F BC = nodes[mask, 0] return nodes, mats, els, loads, BC con esta función se definen las variables necesarias para hacer análisis de elementos finitos\nlength = 20 height = 10 nx = 50 ny= 20 nodes, mats, els, loads, BC = beam(L=length, H=height, nx=nx, ny=ny) elsI,nodesI = np.copy(els), np.copy(nodes) Análisis de elementos finitos Con estas variables ya podemos resolver el problema y obtener los desplazamientos, deformaciones y tensiones. Para calcular el análisis de elementos finitos se utiliza la biblioteca Solidspy 1.0.16.\ndef preprocessing(nodes, mats, els, loads): \"\"\" Compute IBC matrix and the static solve. Parameters ---------- nodes : ndarray Array with models nodes mats : ndarray Array with models materials els : ndarray Array with models elements loads : ndarray Array with models loads Returns ------- bc_array : ndarray Boundary conditions array disp : ndarray Static displacement solve. \"\"\" assem_op, bc_array, neq = ass.DME(nodes[:, -2:], els, ndof_el_max=8) print(\"Number of elements: {}\".format(els.shape[0])) # System assembly stiff_mat, _ = ass.assembler(els, mats, nodes[:, :3], neq, assem_op) rhs_vec = ass.loadasem(loads, bc_array, neq) # System solution disp = sol.static_sol(stiff_mat, rhs_vec) if not np.allclose(stiff_mat.dot(disp)/stiff_mat.max(), rhs_vec/stiff_mat.max()): print(\"The system is not in equilibrium!\") return bc_array, disp def postprocessing(nodes, mats, els, IBC, UG): \"\"\" Compute the nodes displacements, strains and stresses. Parameters ---------- nodes : ndarray Array with models nodes mats : ndarray Array with models materials els : ndarray Array with models elements IBC : ndarray Boundary conditions array UG : ndarray Static solve. Returns ------- disp_complete : ndarray Displacements at elements. strain_nodes : ndarray Strains at elements. stress_nodes : ndarray Stresses at elements. \"\"\" disp_complete = pos.complete_disp(bc_array, nodes, disp) strain_nodes, stress_nodes = None, None strain_nodes, stress_nodes = pos.strain_nodes(nodes, els, mats, disp_complete) return disp_complete, strain_nodes, stress_nodes Optimización Primero definamos el número de iteraciones niter, la relación de rechazo RR, la relación de evolución ER y la fracción de volumen óptima V_opt.\nEn la secuencia cíclica, primero verificamos si el sistema aún está en equilibrio; de lo contrario, el ciclo se detendrá; después de eso, resolvemos el problema y calculamos el estrés de Von Mises para cada elemento y lo escalamos. mask_del es un arreglo numpy de tipo bool con el mismo tamaño de els, las posiciones con valor True indicarán que el elemento en esa posición exacta será eliminado, con la función protect_els() evitaremos la remoción de los elementos donde se definieron las cargas y condiciones de contorno.\nDespués de borrar los elementos del arreglo tenemos que dar un paso más para asegurar que el análisis FEM no fallará con el nuevo arreglo els, para esto tenemos que restringir los nodos libres del_node(). Como último paso aumentamos la tasa de rechazo.\ndef is_equilibrium(nodes, mats, els, loads): \"\"\" Check if the system is in equilibrium Parameters ---------- nodes : ndarray Array with models nodes mats : ndarray Array with models materials els : ndarray Array with models elements loads : ndarray Array with models loads Returns ------- equil : bool Variable True when the system is in equilibrium and False when it doesn't \"\"\" equil = True DME, IBC, neq = ass.DME(nodes, els) KG = ass.assembler(els, mats, nodes, neq, DME) RHSG = ass.loadasem(loads, IBC, neq) UG = sol.static_sol(KG, RHSG) if not(np.allclose(KG.dot(UG)/KG.max(), RHSG/KG.max())): equil = False return equil def strain_els(els, E_nodes, S_nodes): \"\"\" Compute the elements strains and stresses. Parameters ---------- els : ndarray Array with models elements E_nodes : ndarray Strains at nodes. S_nodes : ndarray Stresses at nodes. Returns ------- E_els : ndarray (nnodes, 3) Strains at elements. S_els : ndarray (nnodes, 3) Stresses at elements. \"\"\" E_els = [] S_els = [] for el in els: strain_nodes = np.take(E_nodes, list(el[3:]), 0) stress_nodes = np.take(S_nodes, list(el[3:]), 0) strain_elemt = (strain_nodes[0] + strain_nodes[1] + strain_nodes[2] + strain_nodes[3]) / 4 stress_elemt = (stress_nodes[0] + stress_nodes[1] + stress_nodes[2] + stress_nodes[3]) / 4 E_els.append(strain_elemt) S_els.append(stress_elemt) E_els = np.array(E_els) S_els = np.array(S_els) return E_els, S_els def volume(els, length, height, nx, ny): \"\"\" Volume calculation. Parameters ---------- els : ndarray Array with models elements. length : ndarray Length of the beam. height : ndarray Height of the beam. nx : float ny : float Return ---------- V: float \"\"\" dy = length / nx dx = height / ny V = dx * dy * els.shape[0] return V def del_node(nodes, els): \"\"\" Retricts nodes dof that aren't been used. Parameters ---------- nodes : ndarray Array with models nodes els : ndarray Array with models elements Returns ------- \"\"\" n_nodes = nodes.shape[0] for n in range(n_nodes): if n not in els[:, -4:]: nodes[n, -2:] = -1 def protect_els(els, loads, BC): \"\"\" Compute an mask array with the elements that don't must be deleted. Parameters ---------- els : ndarray Array with models elements loads : ndarray Array with models loads BC : ndarray Boundary conditions nodes Returns ------- mask_els : ndarray Array with the elements that don't must be deleted. \"\"\" mask_els = np.ones_like(els[:,0], dtype=bool) protect_nodes = np.hstack((loads[:,0], BC)).astype(int) protect_index = None for p in protect_nodes: protect_index = np.argwhere(els[:, -4:] == p)[:,0] mask_els[protect_index] = False return mask_els niter = 200 RR = 0.01 ER = 0.005 V_opt = volume(els, length, height, nx, ny) * 0.60 ELS = None for _ in range(niter): if not is_equilibrium(nodes, mats, els, loads) or volume(els, length, height, nx, ny) \u003c V_opt: break ELS = els IBC, UG = preprocessing(nodes, mats, els, loads) UC, E_nodes, S_nodes = postprocessing(nodes, mats, els, IBC, UG) E_els, S_els = strain_els(els, E_nodes, S_nodes) vons = np.sqrt(S_els[:,0]**2 - (S_els[:,0]*S_els[:,1]) + S_els[:,1]**2 + 3*S_els[:,2]**2) RR_el = vons/vons.max() mask_del = RR_el \u003c RR mask_els = protect_els(els, loads, BC) mask_del *= mask_els els = np.delete(els, mask_del, 0) del_node(nodes, els) RR += ER print(RR) Resultados Como se puede observar en la figura 2 se presentan los resultados del ejercicio propuesto al inicio del post, para el gráfico 2.a se evidencia que el método sí converge a una estructura óptima, sin embargo se evidencian varios elementos libres que también pueden Se eliminan para obtener una mejor topología. Este problema se produce porque el método no tiene en cuenta la dependencia de la malla y el patrón de tablero de ajedrez. Para obtener mejores resultados, puede variar $RR$, $ER$ o también aumentar la cantidad de elementos finitos.\nFigura 2. Topologías ESO para vigas en voladizo con diferente fracción de volumen: (a) 80%; (b) 70%; c) 60 %; (d) 50%. Referencias [1] Nabaki, K., Shen, J. y Huang, X. (2019). Optimización topológica evolutiva de estructuras continuas considerando falla por fatiga. Materiales y diseño, 166, 107586. doi:10.1016/j.matdes.2019.107586\n",
  "wordCount" : "1342",
  "inLanguage": "es",
  "datePublished": "2023-04-23T11:48:52-05:00",
  "dateModified": "2023-04-23T11:48:52-05:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://kssgarcia.github.io/es/posts/how_eso/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Kssgarcia",
    "logo": {
      "@type": "ImageObject",
      "url": "http://kssgarcia.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://kssgarcia.github.io/es/" accesskey="h" title="Kssgarcia (Alt + H)">Kssgarcia</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://kssgarcia.github.io/" title="English"
                            aria-label="English">En</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://kssgarcia.github.io/es/" title="Kssgarcia">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://kssgarcia.github.io/es/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://kssgarcia.up.railway.app/" title="Portafolio">
                    <span>Portafolio</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>

    
    <h1 class="post-title">
      Código de optimización ESO
    </h1>
    <div class="post-meta"><span title='2023-04-23 11:48:52 -0500 -05'>abril 23, 2023</span>&nbsp;|&nbsp;Traducciones:
<ul class="i18n_list">
    <li>
        <a href="http://kssgarcia.github.io/posts/how_eso/">En</a>
    </li>
</ul>

</div>
  </header> 
  <div class="post-content"><p>En esta publicación, presentaré un código Python para el método de optimización de ESO.</p>
<h3 id="planteamiento-del-problema">Planteamiento del problema<a hidden class="anchor" aria-hidden="true" href="#planteamiento-del-problema">#</a></h3>
<p>Consideremos una viga en voladizo con una fuerza vertical de 10kN, dimensiones 20x10 metros, módulo joven de 206.8 GPa y relación de Poisson 0.28 figura 1 $RR=0.01$, $ER=0.005$.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><img loading="lazy" src="/ESO_model.png" alt="Scenario 1: Across columns"  />
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><!-- raw HTML omitted -->Figura 1. Diagrama de vigas.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<p>Primero, consideremos los siguientes pasos para hacer el algoritmo:</p>
<ol>
<li>Discretización del modelo en elementos finitos</li>
<li>Realizar el análisis de elementos finitos de la estructura.</li>
<li>Eliminar elementos con menos estrés de Von Mises.</li>
<li>Aumentar la tasa de rechazo.</li>
<li>Repita los pasos 2-4 hasta alcanzar la fracción de volumen.</li>
</ol>
<h3 id="discretización">Discretización<a hidden class="anchor" aria-hidden="true" href="#discretización">#</a></h3>
<p>La discretización se realiza con la siguiente función con la ayuda de numpy</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">beam</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">F</span><span class="o">=-</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mf">206.8e9</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mf">0.28</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Make the mesh for a cuadrilateral model.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    L : float (optional)
</span></span></span><span class="line"><span class="cl"><span class="s2">        Beam&#39;s lenght
</span></span></span><span class="line"><span class="cl"><span class="s2">    H : float (optional)
</span></span></span><span class="line"><span class="cl"><span class="s2">        Beam&#39;s height
</span></span></span><span class="line"><span class="cl"><span class="s2">    F : float (optional)
</span></span></span><span class="line"><span class="cl"><span class="s2">        Vertical force.
</span></span></span><span class="line"><span class="cl"><span class="s2">    E : string (optional)
</span></span></span><span class="line"><span class="cl"><span class="s2">        Young module
</span></span></span><span class="line"><span class="cl"><span class="s2">    v : string (optional)
</span></span></span><span class="line"><span class="cl"><span class="s2">        Poisson ratio
</span></span></span><span class="line"><span class="cl"><span class="s2">    nx : int (optional)
</span></span></span><span class="line"><span class="cl"><span class="s2">        Number of element in x direction
</span></span></span><span class="line"><span class="cl"><span class="s2">    ny : int (optional)
</span></span></span><span class="line"><span class="cl"><span class="s2">        Number of element in y direction
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    nodes : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Nodes array
</span></span></span><span class="line"><span class="cl"><span class="s2">    mats : ndarray (1, 2)
</span></span></span><span class="line"><span class="cl"><span class="s2">        Mats array
</span></span></span><span class="line"><span class="cl"><span class="s2">    els : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Elements array
</span></span></span><span class="line"><span class="cl"><span class="s2">    loads : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Loads array
</span></span></span><span class="line"><span class="cl"><span class="s2">    BC : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Boundary conditions nodes
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">mats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">E</span><span class="p">,</span><span class="n">v</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">els</span> <span class="o">=</span> <span class="n">pre</span><span class="o">.</span><span class="n">rect_grid</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(((</span><span class="n">nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">nodes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">((</span><span class="n">nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">nodes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">    <span class="n">nodes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">nodes</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">mask_loads</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">H</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">H</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">loads_nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">mask_loads</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">loads</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">loads_nodes</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">loads</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">loads_nodes</span>
</span></span><span class="line"><span class="cl">    <span class="n">loads</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span>
</span></span><span class="line"><span class="cl">    <span class="n">BC</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">els</span><span class="p">,</span> <span class="n">loads</span><span class="p">,</span> <span class="n">BC</span>
</span></span></code></pre></div><p>con esta función se definen las variables necesarias para hacer análisis de elementos finitos</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">length</span> <span class="o">=</span> <span class="mi">20</span>
</span></span><span class="line"><span class="cl"><span class="n">height</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">nx</span> <span class="o">=</span> <span class="mi">50</span>
</span></span><span class="line"><span class="cl"><span class="n">ny</span><span class="o">=</span> <span class="mi">20</span>
</span></span><span class="line"><span class="cl"><span class="n">nodes</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">els</span><span class="p">,</span> <span class="n">loads</span><span class="p">,</span> <span class="n">BC</span> <span class="o">=</span> <span class="n">beam</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="n">ny</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elsI</span><span class="p">,</span><span class="n">nodesI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">els</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="análisis-de-elementos-finitos">Análisis de elementos finitos<a hidden class="anchor" aria-hidden="true" href="#análisis-de-elementos-finitos">#</a></h3>
<p>Con estas variables ya podemos resolver el problema y obtener los desplazamientos, deformaciones y tensiones. Para calcular el análisis de elementos finitos se utiliza la biblioteca <a href="https://github.com/AppliedMechanics-EAFIT/SolidsPy">Solidspy 1.0.16</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">preprocessing</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">els</span><span class="p">,</span> <span class="n">loads</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Compute IBC matrix and the static solve.
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    nodes : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models nodes
</span></span></span><span class="line"><span class="cl"><span class="s2">    mats : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models materials
</span></span></span><span class="line"><span class="cl"><span class="s2">    els : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models elements
</span></span></span><span class="line"><span class="cl"><span class="s2">    loads : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models loads
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    bc_array : ndarray 
</span></span></span><span class="line"><span class="cl"><span class="s2">        Boundary conditions array
</span></span></span><span class="line"><span class="cl"><span class="s2">    disp : ndarray 
</span></span></span><span class="line"><span class="cl"><span class="s2">        Static displacement solve.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">assem_op</span><span class="p">,</span> <span class="n">bc_array</span><span class="p">,</span> <span class="n">neq</span> <span class="o">=</span> <span class="n">ass</span><span class="o">.</span><span class="n">DME</span><span class="p">(</span><span class="n">nodes</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">els</span><span class="p">,</span> <span class="n">ndof_el_max</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Number of elements: </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">els</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># System assembly</span>
</span></span><span class="line"><span class="cl">    <span class="n">stiff_mat</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ass</span><span class="o">.</span><span class="n">assembler</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">neq</span><span class="p">,</span> <span class="n">assem_op</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">rhs_vec</span> <span class="o">=</span> <span class="n">ass</span><span class="o">.</span><span class="n">loadasem</span><span class="p">(</span><span class="n">loads</span><span class="p">,</span> <span class="n">bc_array</span><span class="p">,</span> <span class="n">neq</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># System solution</span>
</span></span><span class="line"><span class="cl">    <span class="n">disp</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">static_sol</span><span class="p">(</span><span class="n">stiff_mat</span><span class="p">,</span> <span class="n">rhs_vec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">stiff_mat</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span><span class="o">/</span><span class="n">stiff_mat</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                       <span class="n">rhs_vec</span><span class="o">/</span><span class="n">stiff_mat</span><span class="o">.</span><span class="n">max</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The system is not in equilibrium!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">bc_array</span><span class="p">,</span> <span class="n">disp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">postprocessing</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">els</span><span class="p">,</span> <span class="n">IBC</span><span class="p">,</span> <span class="n">UG</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Compute the nodes displacements, strains and stresses.
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    nodes : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models nodes
</span></span></span><span class="line"><span class="cl"><span class="s2">    mats : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models materials
</span></span></span><span class="line"><span class="cl"><span class="s2">    els : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models elements
</span></span></span><span class="line"><span class="cl"><span class="s2">    IBC : ndarray 
</span></span></span><span class="line"><span class="cl"><span class="s2">        Boundary conditions array
</span></span></span><span class="line"><span class="cl"><span class="s2">    UG : ndarray 
</span></span></span><span class="line"><span class="cl"><span class="s2">        Static solve.
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    disp_complete : ndarray 
</span></span></span><span class="line"><span class="cl"><span class="s2">        Displacements at elements.
</span></span></span><span class="line"><span class="cl"><span class="s2">    strain_nodes : ndarray 
</span></span></span><span class="line"><span class="cl"><span class="s2">        Strains at elements.
</span></span></span><span class="line"><span class="cl"><span class="s2">    stress_nodes : ndarray 
</span></span></span><span class="line"><span class="cl"><span class="s2">        Stresses at elements.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">disp_complete</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">complete_disp</span><span class="p">(</span><span class="n">bc_array</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">disp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">strain_nodes</span><span class="p">,</span> <span class="n">stress_nodes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">	<span class="n">strain_nodes</span><span class="p">,</span> <span class="n">stress_nodes</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">strain_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">els</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">disp_complete</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">disp_complete</span><span class="p">,</span> <span class="n">strain_nodes</span><span class="p">,</span> <span class="n">stress_nodes</span>
</span></span></code></pre></div><h3 id="optimización">Optimización<a hidden class="anchor" aria-hidden="true" href="#optimización">#</a></h3>
<p>Primero definamos el número de iteraciones <code>niter</code>, la relación de rechazo <code>RR</code>, la relación de evolución <code>ER</code> y la fracción de volumen óptima <code>V_opt</code>.</p>
<p>En la secuencia cíclica, primero verificamos si el sistema aún está en equilibrio; de lo contrario, el ciclo se detendrá; después de eso, resolvemos el problema y calculamos el estrés de Von Mises para cada elemento y lo escalamos. <code>mask_del</code> es un arreglo numpy de tipo bool con el mismo tamaño de <code>els</code>, las posiciones con valor <code>True</code> indicarán que el elemento en esa posición exacta será eliminado, con la función <code>protect_els()</code> evitaremos la remoción de los elementos donde se definieron las cargas y condiciones de contorno.</p>
<p>Después de borrar los elementos del arreglo tenemos que dar un paso más para asegurar que el análisis FEM no fallará con el nuevo arreglo <code>els</code>, para esto tenemos que restringir los nodos libres <code>del_node()</code>. Como último paso aumentamos la tasa de rechazo.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">is_equilibrium</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">els</span><span class="p">,</span> <span class="n">loads</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Check if the system is in equilibrium
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    nodes : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models nodes
</span></span></span><span class="line"><span class="cl"><span class="s2">    mats : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models materials
</span></span></span><span class="line"><span class="cl"><span class="s2">    els : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models elements
</span></span></span><span class="line"><span class="cl"><span class="s2">    loads : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models loads
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    equil : bool
</span></span></span><span class="line"><span class="cl"><span class="s2">        Variable True when the system is in equilibrium and False when it doesn&#39;t
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">equil</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="n">DME</span><span class="p">,</span> <span class="n">IBC</span><span class="p">,</span> <span class="n">neq</span> <span class="o">=</span> <span class="n">ass</span><span class="o">.</span><span class="n">DME</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">els</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">KG</span> <span class="o">=</span> <span class="n">ass</span><span class="o">.</span><span class="n">assembler</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">neq</span><span class="p">,</span> <span class="n">DME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">RHSG</span> <span class="o">=</span> <span class="n">ass</span><span class="o">.</span><span class="n">loadasem</span><span class="p">(</span><span class="n">loads</span><span class="p">,</span> <span class="n">IBC</span><span class="p">,</span> <span class="n">neq</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">UG</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">static_sol</span><span class="p">(</span><span class="n">KG</span><span class="p">,</span> <span class="n">RHSG</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">KG</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">UG</span><span class="p">)</span><span class="o">/</span><span class="n">KG</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">RHSG</span><span class="o">/</span><span class="n">KG</span><span class="o">.</span><span class="n">max</span><span class="p">())):</span>
</span></span><span class="line"><span class="cl">        <span class="n">equil</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">equil</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">strain_els</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="n">E_nodes</span><span class="p">,</span> <span class="n">S_nodes</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Compute the elements strains and stresses.
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    els : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models elements
</span></span></span><span class="line"><span class="cl"><span class="s2">    E_nodes : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Strains at nodes.
</span></span></span><span class="line"><span class="cl"><span class="s2">    S_nodes : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Stresses at nodes.
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    E_els : ndarray (nnodes, 3)
</span></span></span><span class="line"><span class="cl"><span class="s2">        Strains at elements.
</span></span></span><span class="line"><span class="cl"><span class="s2">    S_els : ndarray (nnodes, 3)
</span></span></span><span class="line"><span class="cl"><span class="s2">        Stresses at elements.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>   
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">E_els</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">S_els</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">els</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">strain_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">E_nodes</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">:]),</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">stress_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">S_nodes</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">:]),</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">strain_elemt</span> <span class="o">=</span> <span class="p">(</span><span class="n">strain_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">strain_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">strain_nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">strain_nodes</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">        <span class="n">stress_elemt</span> <span class="o">=</span> <span class="p">(</span><span class="n">stress_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress_nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">stress_nodes</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">        <span class="n">E_els</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strain_elemt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">S_els</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stress_elemt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">E_els</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">E_els</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">S_els</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">S_els</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">E_els</span><span class="p">,</span> <span class="n">S_els</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">volume</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Volume calculation.
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    els : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models elements.
</span></span></span><span class="line"><span class="cl"><span class="s2">    length : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Length of the beam.
</span></span></span><span class="line"><span class="cl"><span class="s2">    height : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Height of the beam.
</span></span></span><span class="line"><span class="cl"><span class="s2">    nx : float
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    ny : float
</span></span></span><span class="line"><span class="cl"><span class="s2">    Return 
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    V: float
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">dy</span> <span class="o">=</span> <span class="n">length</span> <span class="o">/</span> <span class="n">nx</span>
</span></span><span class="line"><span class="cl">    <span class="n">dx</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">ny</span>
</span></span><span class="line"><span class="cl">    <span class="n">V</span>   <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">els</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">V</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">del_node</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">els</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Retricts nodes dof that aren&#39;t been used.
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    nodes : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models nodes
</span></span></span><span class="line"><span class="cl"><span class="s2">    els : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models elements
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>   
</span></span><span class="line"><span class="cl">    <span class="n">n_nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">els</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">4</span><span class="p">:]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">protect_els</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="n">loads</span><span class="p">,</span> <span class="n">BC</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Compute an mask array with the elements that don&#39;t must be deleted.
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Parameters
</span></span></span><span class="line"><span class="cl"><span class="s2">    ----------
</span></span></span><span class="line"><span class="cl"><span class="s2">    els : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models elements
</span></span></span><span class="line"><span class="cl"><span class="s2">    loads : ndarray
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with models loads
</span></span></span><span class="line"><span class="cl"><span class="s2">    BC : ndarray 
</span></span></span><span class="line"><span class="cl"><span class="s2">        Boundary conditions nodes
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns
</span></span></span><span class="line"><span class="cl"><span class="s2">    -------
</span></span></span><span class="line"><span class="cl"><span class="s2">    mask_els : ndarray 
</span></span></span><span class="line"><span class="cl"><span class="s2">        Array with the elements that don&#39;t must be deleted.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>   
</span></span><span class="line"><span class="cl">    <span class="n">mask_els</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">els</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">protect_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">loads</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">BC</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">protect_index</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">protect_nodes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">protect_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">els</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="n">p</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">mask_els</span><span class="p">[</span><span class="n">protect_index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">mask_els</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">niter</span> <span class="o">=</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl"><span class="n">RR</span> <span class="o">=</span> <span class="mf">0.01</span>
</span></span><span class="line"><span class="cl"><span class="n">ER</span> <span class="o">=</span> <span class="mf">0.005</span>
</span></span><span class="line"><span class="cl"><span class="n">V_opt</span> <span class="o">=</span> <span class="n">volume</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.60</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ELS</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_equilibrium</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">els</span><span class="p">,</span> <span class="n">loads</span><span class="p">)</span> <span class="ow">or</span> <span class="n">volume</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">V_opt</span><span class="p">:</span> <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">ELS</span> <span class="o">=</span> <span class="n">els</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">IBC</span><span class="p">,</span> <span class="n">UG</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">els</span><span class="p">,</span> <span class="n">loads</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">UC</span><span class="p">,</span> <span class="n">E_nodes</span><span class="p">,</span> <span class="n">S_nodes</span> <span class="o">=</span> <span class="n">postprocessing</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">mats</span><span class="p">,</span> <span class="n">els</span><span class="p">,</span> <span class="n">IBC</span><span class="p">,</span> <span class="n">UG</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">E_els</span><span class="p">,</span> <span class="n">S_els</span> <span class="o">=</span> <span class="n">strain_els</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="n">E_nodes</span><span class="p">,</span> <span class="n">S_nodes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">vons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S_els</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">S_els</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">S_els</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">S_els</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">S_els</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">RR_el</span> <span class="o">=</span> <span class="n">vons</span><span class="o">/</span><span class="n">vons</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">mask_del</span> <span class="o">=</span> <span class="n">RR_el</span> <span class="o">&lt;</span> <span class="n">RR</span>
</span></span><span class="line"><span class="cl">    <span class="n">mask_els</span> <span class="o">=</span> <span class="n">protect_els</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="n">loads</span><span class="p">,</span> <span class="n">BC</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">mask_del</span> <span class="o">*=</span> <span class="n">mask_els</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">els</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">els</span><span class="p">,</span> <span class="n">mask_del</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">del_node</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">els</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">RR</span> <span class="o">+=</span> <span class="n">ER</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">RR</span><span class="p">)</span>
</span></span></code></pre></div><h1 id="resultados">Resultados<a hidden class="anchor" aria-hidden="true" href="#resultados">#</a></h1>
<p>Como se puede observar en la <em>figura 2</em> se presentan los resultados del ejercicio propuesto al inicio del post, para el gráfico <em>2.a</em> se evidencia que el método sí converge a una estructura óptima, sin embargo se evidencian varios elementos libres que también pueden Se eliminan para obtener una mejor topología. Este problema se produce porque el método no tiene en cuenta la dependencia de la malla y el patrón de tablero de ajedrez. Para obtener mejores resultados, puede variar $RR$, $ER$ o también aumentar la cantidad de elementos finitos.</p>
<table>
<thead>
<tr>
<th style="text-align:center"><img loading="lazy" src="/ESO_1.png" alt="Scenario 1: Across columns"  />
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><!-- raw HTML omitted -->Figura 2. Topologías ESO para vigas en voladizo con diferente fracción de volumen: (a) 80%; (b) 70%; c) 60 %; (d) 50%.<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h1 id="referencias">Referencias<a hidden class="anchor" aria-hidden="true" href="#referencias">#</a></h1>
<p>[1] Nabaki, K., Shen, J. y Huang, X. (2019). Optimización topológica evolutiva de estructuras continuas considerando falla por fatiga. <em>Materiales y diseño</em>, <em>166</em>, 107586. doi:10.1016/j.matdes.2019.107586</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="http://kssgarcia.github.io/es/">Kssgarcia</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>
</html>
